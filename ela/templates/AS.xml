<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:h="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:jr="http://openrosa.org/javarosa" xmlns:orx="http://openrosa.org/xforms"
    xmlns:odk="http://www.opendatakit.org/xforms">
    <h:head>
        <h:title>{{ title }}</h:title>
        <model odk:xforms-version="1.0.0">
            <instance>
                <data id="{{ id }}" version="1">
                    <startTime />
                    <form_introduction>
                        <form_id />
                        <note />
                        <cohort />
                        <space />
                        <assessments />
                        <num_assessments />
                    </form_introduction>
                    <form_configuration>
                        <learner />
                        <teacher />
                        <activity />
                    </form_configuration>
                    <question_1>
                        <question_1_prompt />
                        <assessment_id_1 />
                        <question_1_type />
                        <question_1_audio />
                    </question_1>
                    <question_2>
                        <question_2_prompt />
                        <assessment_id_2 />
                        <question_2_type />
                        <question_2_singlechoice />
                    </question_2>
                    <meta>
                        <instanceID />
                    </meta>
                </data>
            </instance>
            <instance id="__last-saved" src="jr://instance/last-saved" />
            <instance id="activity">
                <root>
                    <item>
                        <label>{{ activity_label }}</label>
                        <name>{{ activity_name}}</name>
                    </item>
                </root>
            </instance>
            <instance id="learner">
                <root> {% for learner in learners %} <item>
                        <label>{{ learner.display_name }}</label>
                        <name>{{ learner.learner_eid }}</name>
                    </item> {% endfor %} </root>
            </instance>
            <instance id="teacher">
                <root> {% for teacher in teachers %} <item>
                        <label>{{ teacher.display_name }}</label>
                        <name>{{ teacher.teacher_eid }}</name>
                    </item> {% endfor %} </root>
            </instance>
            <instance id="question_2">
                <root> {% for choice_key, choice_label in all_choice_questions[0].items() %} <item>
                        <label>{{ choice_label }}</label>
                        <name>{{ choice_key }}</name>
                    </item> {% endfor %} </root>
            </instance>
            <bind nodeset="/data/startTime" jr:preload="timestamp" type="dateTime"
                jr:preloadParams="start" />
            <bind nodeset="/data/form_introduction/form_id" type="string"
                calculate="&quot;{{ id }}&quot;" />
            <bind nodeset="/data/form_introduction/note" readonly="true()" type="string" />
            <bind nodeset="/data/form_introduction/cohort" type="string" readonly="true()" />
            <bind nodeset="/data/form_introduction/space" type="string" readonly="true()" />
            <bind nodeset="/data/form_introduction/assessments" type="string" readonly="true()" />
            <bind nodeset="/data/form_introduction/num_assessments" type="string"
                calculate="&quot;{{ assessment_count }}&quot;" />
            <bind nodeset="/data/form_configuration/learner" type="string" required="true()" />
            <bind nodeset="/data/form_configuration/teacher" type="string" required="true()" />
            <setvalue ref="/data/form_configuration/teacher" event="odk-instance-first-load"
                value=" instance('__last-saved')/data/form_configuration/teacher " />
            <bind nodeset="/data/form_configuration/activity" type="string" required="true()" />
            <setvalue ref="/data/form_configuration/activity" event="odk-instance-first-load"
                value=" instance('__last-saved')/data/form_configuration/activity " />
            <bind nodeset="/data/question_1/question_1_prompt" readonly="true()" type="string" />
            <bind nodeset="/data/question_1/assessment_id_1" type="string"
                calculate="&quot;{{ assessment_ids[0] }}&quot;" />
            <bind nodeset="/data/question_1/question_1_type" type="string"
                calculate="&quot;{{ question_types[0] }}&quot;" />
            <bind nodeset="/data/question_1/question_1_audio" type="binary" required="true()"
                odk:quality="normal" />
            <bind nodeset="/data/question_2/question_2_prompt" readonly="true()" type="string" />
            <bind nodeset="/data/question_2/assessment_id_2" type="string"
                calculate="&quot;{{ assessment_ids[1] }}&quot;" />
            <bind nodeset="/data/question_2/question_2_type" type="string"
                calculate="&quot;{{ question_types[1] }}&quot;" />
            <bind nodeset="/data/question_2/question_2_singlechoice" type="string" required="true()" />
            <bind nodeset="/data/meta/instanceID" type="string" readonly="true()" jr:preload="uid" />
        </model>
    </h:head>
    <h:body>
        <group appearance="field-list" ref="/data/form_introduction">
            <label>{{ id }}</label>
            <input ref="/data/form_introduction/note">
                <label>{{ brief_note }}</label>
            </input>
            <input ref="/data/form_introduction/cohort">
                <label>Learner cohort: {{ cohort_id }}</label>
            </input>
            <input ref="/data/form_introduction/space">
                <label>Learning space: {{ learning_space_id }}</label>
            </input>
            <input ref="/data/form_introduction/assessments">
                <label>The following {{ assessment_count }} assessment(s) are included in this form
                    {{ question_types[0] }}: {{ assessment_ids[0] }}
                    {{ question_types[1] }}: {{ assessment_ids[1] }}</label>
            </input>
        </group>
        <group appearance="field-list" ref="/data/form_configuration">
            <label>{{ id }}</label>
            <select1 ref="/data/form_configuration/learner" appearance="minimal">
                <label>Learner</label>
                <itemset nodeset="instance('learner')/root/item">
                    <value ref="name" />
                    <label ref="label" />
                </itemset>
            </select1>
            <select1 ref="/data/form_configuration/teacher" appearance="minimal">
                <label>Teacher</label>
                <itemset nodeset="instance('teacher')/root/item">
                    <value ref="name" />
                    <label ref="label" />
                </itemset>
            </select1>
            <select1 ref="/data/form_configuration/activity" appearance="minimal">
                <label>Activity</label>
                <itemset nodeset="instance('activity')/root/item">
                    <value ref="name" />
                    <label ref="label" />
                </itemset>
            </select1>
        </group>
        <group appearance="field-list" ref="/data/question_1">
            <label>{{ question_titles[0] }}</label>
            <input ref="/data/question_1/question_1_prompt">
                <label>{{ question_prompts[0] }}</label>
            </input>
            <upload ref="/data/question_1/question_1_audio" mediatype="audio/*" appearance="new">
                <label>{{ question_actions[0] }}</label>
            </upload>
        </group>
        <group appearance="field-list" ref="/data/question_2">
            <label>{{ question_titles[1] }}</label>
            <input ref="/data/question_2/question_2_prompt">
                <label>{{ question_prompts[1] }}</label>
            </input>
            <select1 ref="/data/question_2/question_2_singlechoice">
                <label>{{ question_actions[1] }}</label>
                <itemset nodeset="instance('question_2')/root/item">
                    <value ref="name" />
                    <label ref="label" />
                </itemset>
            </select1>
        </group>
    </h:body>
</h:html>